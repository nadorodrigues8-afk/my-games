<script>
let allGames = [];

// Correct league names used by TheSportsDB
const ELITE_LEAGUES = [
    "english premier league",
    "primeira liga",
    "uefa champions league",
    "fa cup",
    "ta√ßa de portugal"
];

function init() {
    const cal = document.getElementById('cal');
    for (let i = 0; i < 7; i++) {
        const d = new Date();
        d.setDate(d.getDate() + i);
        const btn = document.createElement('div');
        btn.className = `day ${i === 0 ? 'active' : ''}`;
        btn.innerHTML = `<div>${d.toLocaleDateString([], { weekday: 'short' })}</div><div>${d.getDate()}</div>`;
        btn.onclick = () => {
            document.querySelectorAll('.day').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            load(d.toISOString().split('T')[0]);
        };
        cal.appendChild(btn);
    }
    load(new Date().toISOString().split('T')[0]);
}

async function load(date) {
    const div = document.getElementById('list');
    div.innerHTML = "Fetching matches...";
    try {
        const res = await fetch(`https://www.thesportsdb.com/api/v1/json/3/eventsday.php?d=${date}&s=Soccer`);
        const data = await res.json();

        if (!data.events) {
            div.innerHTML = `<div class="no-data">No matches found for ${date}</div>`;
            return;
        }

        allGames = data.events.filter(g => {
            const league = g.strLeague?.toLowerCase() || "";
            const event = g.strEvent?.toLowerCase() || "";

            return (
                ELITE_LEAGUES.some(l => league.includes(l)) ||
                event.includes("porto") ||
                event.includes("liverpool")
            );
        });

        render(allGames, date);
    } catch (e) {
        div.innerHTML = "API error. Try again later.";
    }
}

function render(list, date) {
    const div = document.getElementById('list');

    if (!list.length) {
        div.innerHTML = `<div class="no-data">No elite matches found</div>`;
        return;
    }

    div.innerHTML = list.map(g => {
        let time = "TBD";
        if (g.strTime) {
            time = new Date(`${g.dateEvent || date}T${g.strTime}Z`)
                .toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
        }

        return `
        <div class="game ${g.strSport}">
            <div class="info">
                <span class="league">${g.strLeague}</span>
                <div class="match">${g.strEvent}</div>
                <span class="time">${time} (Portugal)</span>
            </div>
        </div>`;
    }).join('');
}

function filter() {
    const q = document.getElementById('search').value.toLowerCase();
    render(allGames.filter(g => g.strEvent.toLowerCase().includes(q)));
}

init();
</script>
